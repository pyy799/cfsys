{% extends 'base1.html' %}

{% block header_js %}
    <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/jpage.css">
    <!-- Morris chart -->
    <link rel="stylesheet" href="/static/plugins/morris/morris.css">
{% endblock %}


{% block content %}
    <div class="box box-solid" id="tablebox" style="padding-left: 100px">
        <div class="box-header with-border">
            <h3>提交产品信息</h3>
        </div>
        <div class="box-body">
            <div class="nav-tabs-custom">
            <!-- Tabs within a box -->
            <ul class="nav nav-tabs pull-left">
                <li class="active"><a href="#new" data-toggle="tab">新建产品</a></li>
                <li><a href="#update" data-toggle="tab">更新产品</a></li>
                <li><a href="#waitsubmit" data-toggle="tab">待提交</a></li>
                <li><a href="#waitpass" data-toggle="tab">待审批</a></li>
                <li><a href="#passed" data-toggle="tab">已审批</a></li>
            </ul>
            <div style="clear:both"></div>
            <div class="tab-content">
                <div class="table-container no-padding tab-pane active" id="new" style="padding:14px">
                    <div class="table-actions-wrapper">

                        <a type="button" class="btn btn-block btn-default"  target="_blank"
                        href="{{ download_path_excel }}" download="产品信息模版">批量新建产品excel模版下载</a>

                        <div class="modal fade" id="many" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content" style="height: 400px">
                                    <div class="modal-header" style="margin-top: 100px">
                                        <h3 class="modal-title" id="myModalLabel">批量上传产品</h3>
                                    </div>
                                    <div class="modal-body">
                                        <div class="box box-primary">
                                            <form id="manyuploadForm" class="form-horizontal" enctype="multipart/form-data" method="post">
                                            {% csrf_token %}
                                            <div class="box-body">
                                            <div class="form-group">
                                            <div class="col-sm-12">
                                                <div class="col-sm-6">
                                                <label class="control-label">请上传包含产品信息的文件(.xlsx)*请使用指定模版进行批量上传</label>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="file" class="form-control" name="excel" id="excel" accept=".xlsx,.xls" required/>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="col-sm-6">
                                                <label class="control-label">请上传包含审批信息的压缩文件(.zip)</label>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="file" class="form-control" name="zip" id="zip" accept=".zip,.rar" required/>
                                                </div>
                                            </div>
                                            </div>
                                            </div>
                                            <div class="modal-footer" style="width:50%">
                                                <button type="submit" class="btn btn-primary">提交</button>
                                                <button class="btn btn-default" data-dismiss="modal">关闭</button>
                                            </div>
                                            </form>
                                        </div>
                                    </div>


                                </div>
                                <!-- /.modal-content -->
                            </div>
                            <!-- /.modal -->
                        </div>

                        <button type="button" class="btn btn-block btn-default"  data-toggle="modal" data-target="#many">
                            <i class="fa fa-plus"></i> 批量新建产品
                        </button>

                        <a href="/product_management/edit_product/0" type="button" class="btn btn-block btn-default">
                        单个新建产品</a>
                    </div>
                </div>
                <div class="table-container no-padding tab-pane" id="update" style="padding:14px">
                    <div class="table-actions-wrapper">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="contract_number__icontains" placeholder="产品编号" style="width: 200px">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="customer__name__icontains" placeholder="产品名称" style="width: 200px">
                        <select class="form-control input-inline input-small input-sm form-filter select"
                                name="salesman__pk" data-placeholder='公司'>
                            <option value=''></option>
                            {% for s in salesmen %}
                                <option value="{{ s.pk }}">{{ s.cname }}</option>
                            {% endfor %}
                        </select>
                        <select class="form-control input-inline input-small input-sm form-filter select"
                                name="approval_status" data-placeholder='上传者'>
                            <option value='' selected disabled>---</option>
                            {% for s in approval_status %}
                                <option value="{{ s.0 }}">{{ s.1 }}</option>
                            {% endfor %}
                        </select>
                        <button class="btn btn-sm yellow filter-submit"><i class="fa fa-search"></i> 查询</button>
                        <button class="btn btn-sm red filter-cancel"><i class="fa fa-times"></i> 取消查询</button>
                                                <a class="btn btn-sm blue" type="button" href="/contract/contract_info/edit/0/"><i class="fa fa-plus"></i>批量更新</a>

                    </div>
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="approved"
                           style="word-break: keep-all">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="table-container no-padding tab-pane" id="waitsubmit" style="padding:14px">
                    <div class="table-actions-wrapper">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="contract_number__icontains" placeholder="合同编号" style="width: 200px">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="customer__name__icontains" placeholder="客户名称" style="width: 200px">
                        <select class="form-control input-inline input-small input-sm form-filter select"
                                name="salesman__pk" data-placeholder='销售'>
                            <option value=''></option>
                            {% for s in salesmen %}
                                <option value="{{ s.pk }}">{{ s.cname }}</option>
                            {% endfor %}
                        </select>
                        <button class="btn btn-sm yellow filter-submit"><i class="fa fa-search"></i> 查询</button>
                        <button class="btn btn-sm red filter-cancel"><i class="fa fa-times"></i> 取消查询</button>

                    </div>
                    <div class="modal fade" id="approval_note_dialog" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header" style="margin-top: 100px">
                                    <h4 class="modal-title" id="myModalLabel">添加审批意见</h4>

                                    <div class="box box-primary">
                                        <form id="approval_note_form">
                                            {% csrf_token %}
                                            <div class="box-body">
                                                <div class="col-sm-6">
                                                    <textarea id="approval_note" name="approval_note"
                                                              style="height: 200px; width: 500px"></textarea>
                                                </div>
                                            </div>
                                            <div class="modal-footer" style="">
                                                <button type="submit" class="btn btn-primary">提交</button>
                                                <button class="btn btn-default" data-dismiss="modal">关闭</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="my_approval"
                           style="word-break: keep-all">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="table-container no-padding tab-pane" id="waitpass" style="padding:14px">
                    <div class="table-actions-wrapper">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="contract_number__icontains" placeholder="合同编号" style="width: 200px">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="customer__name__icontains" placeholder="客户名称" style="width: 200px">
                        <select class="form-control input-inline input-small input-sm form-filter select"
                                name="salesman__pk" data-placeholder='销售'>
                            <option value=''></option>
                            {% for s in salesmen %}
                                <option value="{{ s.pk }}">{{ s.cname }}</option>
                            {% endfor %}
                        </select>
                        <button class="btn btn-sm yellow filter-submit"><i class="fa fa-search"></i> 查询</button>
                        <button class="btn btn-sm red filter-cancel"><i class="fa fa-times"></i> 取消查询</button>

                    </div>
                    <div class="modal fade" id="approval_note_dialog" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header" style="margin-top: 100px">
                                    <h4 class="modal-title" id="myModalLabel">添加审批意见</h4>

                                    <div class="box box-primary">
                                        <form id="approval_note_form">
                                            {% csrf_token %}
                                            <div class="box-body">
                                                <div class="col-sm-6">
                                                    <textarea id="approval_note" name="approval_note"
                                                              style="height: 200px; width: 500px"></textarea>
                                                </div>
                                            </div>
                                            <div class="modal-footer" style="">
                                                <button type="submit" class="btn btn-primary">提交</button>
                                                <button class="btn btn-default" data-dismiss="modal">关闭</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="my_approval"
                           style="word-break: keep-all">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="table-container no-padding tab-pane" id="passed" style="padding:14px">
                    <div class="table-actions-wrapper">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="contract_number__icontains" placeholder="合同编号" style="width: 200px">
                        <input type="text" class="form-control input-inline input-middle input-sm form-filter"
                               name="customer__name__icontains" placeholder="客户名称" style="width: 200px">
                        <select class="form-control input-inline input-small input-sm form-filter select"
                                name="salesman__pk" data-placeholder='销售'>
                            <option value=''></option>
                            {% for s in salesmen %}
                                <option value="{{ s.pk }}">{{ s.cname }}</option>
                            {% endfor %}
                        </select>
                        <button class="btn btn-sm yellow filter-submit"><i class="fa fa-search"></i> 查询</button>
                        <button class="btn btn-sm red filter-cancel"><i class="fa fa-times"></i> 取消查询</button>

                    </div>
                    <div class="modal fade" id="approval_note_dialog" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header" style="margin-top: 100px">
                                    <h4 class="modal-title" id="myModalLabel">添加审批意见</h4>

                                    <div class="box box-primary">
                                        <form id="approval_note_form">
                                            {% csrf_token %}
                                            <div class="box-body">
                                                <div class="col-sm-6">
                                                    <textarea id="approval_note" name="approval_note"
                                                              style="height: 200px; width: 500px"></textarea>
                                                </div>
                                            </div>
                                            <div class="modal-footer" style="">
                                                <button type="submit" class="btn btn-primary">提交</button>
                                                <button class="btn btn-default" data-dismiss="modal">关闭</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="my_approval"
                           style="word-break: keep-all">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        </div>
    </div>
{% endblock %}

{% block footer_js %}
    <!-- Morris.js charts -->
    <script src="/static/js/raphael/raphael-min.js"></script>
    <script src="/static/plugins/morris/morris.min.js"></script>

    <script src="/static/plugins/jquery.blockui.min.js"></script>
    <script src="/static/plugins/datatables/jquery.dataTables.js"></script>
    <script src="/static/plugins/datatables/dataTables.bootstrap.min.js"></script>
    <script src="/static/js/metronic.js"></script>
    <script src="/static/js/table-ext.js"></script>
    <script src="/static/js/datatable.js"></script>
    <script src="/static/js/jPages.js"></script>
    <script>
        //批量上传文件
        $("#manyuploadForm").ajaxForm({
            type: "post",
            url: "/product_management/upload_many/",    //提交到的url
            success: function (data) {
                if (data.success) {
                    location.href = "";
                } else {
                    $.growlService("上传文件有误", {type: "danger"})
                }
            }
        });
        function formError(element, obj) {
            $.each(obj, function (key, val) {
                $("" + element + " input[name='" + key + "']").parent().parent().addClass("has-error");
                $("" + element + " input[name='" + key + "']").parent().next().html(val)
            })
        }

    </script>
{% endblock %}
